#!/bin/sh

source @datadir@/dirsrv/data/DSSharedLib

# Script that restarts the ns-slapd server.
# Exit status can be:
#       0: Server restarted successfully
#       1: Server could not be started
#       2: Server started successfully (was not running)
#       3: Server could not be stopped

usage ()
{
    echo "Usage: restart-slapd [-Z serverID]"
}

while getopts "Z:SvVhi:d:w:" flag
do
    case $flag in
        Z) servid=$OPTARG;;
        d) args=$args" -d $OPTARG";;
        v) args=$args" -v";;
        V) args=$args" -V";;
        i) args=$args" -i $OPTARG";;
        w) args=$args" -w $OPTARG";;
        S) args=$args" -S";; 
        h) usage
           exit 0;;
        ?) usage
           exit 1;;
    esac
done

servid=$(get_server_id "@initconfigdir@" $servid)
if [ $? == 1 ]
then
    usage
    echo "You must supply a valid server instance identifier.  Use -Z to specify instance name"
    echo "Available instances: $servid"
    exit 1
fi

@sbindir@/restart-dirsrv -d @initconfigdir@ $servid $args
if [ $? == 0 ]
then
    echo Sucessfully restarted instance \"$servid\"
else
    echo Failed to restart instance \"$servid\"
fi
exit $?
