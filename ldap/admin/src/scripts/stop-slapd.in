#!/bin/sh

source ./DSSharedLib

# Script that stops the ns-slapd server.
# Exit status can be:
#       0: Server stopped successfully
#       1: Server could not be stopped
#       2: Server was not running

usage ()
{
    echo "Usage: stop-slapd [-Z serverID]"
}

while getopts "Z:SvVhi:d:w:" flag
do
    case $flag in
        Z) servid=$OPTARG;;
        d) args=$args" -d $OPTARG";;
        v) args=$args" -v";;
        V) args=$args" -V";;
        i) args=$args" -i $OPTARG";;
        w) args=$args" -w $OPTARG";;
        S) args=$args" -S";;
        h) usage
           exit 0;;
        ?) usage
           exit 1;;
    esac
done

servid=$(get_server_id "@initconfigdir@" $servid)
if [ $? == 1 ]
then
    usage
    echo "You must supply a valid server instance identifier.  Use -Z to specify instance name"
    echo "Available instances: $servid"
    exit 1
fi

@sbindir@/stop-dirsrv -d @initconfigdir@ $servid $args
if [ $? == 0 ]
then
    echo Sucessfully stopped instance $servid
else
    echo Failed to stop instance $servid
fi

exit $?
